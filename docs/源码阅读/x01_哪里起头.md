1. main/main.cpp
    * 但是: 想看真正run的地方, 需要看对应平台代码
    * 例如: platform/linuxbsd/godot_linuxbsd.cpp, 你可以看到main()
2. Godot 选择 Clang/LLVM, 使用scons管理项目
    * scons本质是python写脚本管理项目
3. vscode配置源码,

```txt
┌─────────────────────────────────────┐
│     platform/*/godot_*.cpp          │
├─────────────────────────────────────┤
│  main() {                           │
│    OS_* os;                         │
│    Main::setup();     ← 第一阶段     │
│    if (Main::start()) ← 第二阶段     │
│      os.run();        ← 主循环       │
│    Main::cleanup();   ← 第三阶段     │
│  }                                  │
└─────────────────────────────────────┘
```

# 01. main()
linux来看, 
1. Main::setup 加载模块们
2. os.run(); 透过os的loop执行godot的模块, 内部是Main::iteration处理godot循环
```c++
// platform/linuxbsd/godot_linuxbsd.cpp
#include "main/main.h"

int main(int argc, char *argv[]) {
    OS_LinuxBSD os;  // Linux/BSD 特定的操作系统实现
    
    Error err = Main::setup(argv[0], argc - 1, &argv[1]);
    if (err != OK) {
        return 255;
    }
    
    if (Main::start()) {
        os.run();  // 运行主循环
    }
    
    Main::cleanup();
    
    return os.get_exit_code();
}

// OS 层的性能消耗主要在事件处理
void OS_LinuxBSD::run() {
    // 1. DisplayServer::process_events() - 系统事件处理消耗
    // 2. joypad_sdl->process_events() - 输入设备处理消耗
    // 3. Main::iteration() - 引擎主循环消耗
}

// main/main.cpp 中的性能热点
bool Main::iteration() {
    // 1. 消息队列处理 - 脚本调用消耗
    message_queue->flush();
    
    // 2. 输入处理 - 输入事件分发消耗
    input->flush_buffered_events();
    
    // 3. 场景更新 - 节点逻辑消耗（最重要的部分）
    scene_tree->iteration(delta);
    
    // 4. 物理模拟 - 物理计算消耗
    // 5. 渲染 - GPU 和 CPU 渲染消耗
    rendering_server->draw();
}
```

# 02. Main::setup(), 都加载了什么
基于提供的Godot引擎 [main.cpp](./main/main.cpp) 文件内容，我可以为您总结 `Main::setup` 函数中初始化的主要模块和组件。这些模块构成了Godot引擎的核心架构：

## 核心初始化模块

1. **基准测试模块**
   - 启动性能基准测试 (`OS::get_singleton()->benchmark_begin_measure`)
   - 测量各个初始化阶段的性能表现

2. **线程池模块**
   - 初始化工作线程池 (`WorkerThreadPool::get_singleton()->init`)
   - 支持多线程任务处理

3. **渲染相关模块**
   - 渲染服务器初始化 ([RenderingServer](./servers/rendering/rendering_server.h#L57-L1920))
   - 渲染设备创建和配置
   - 显示服务器设置 ([DisplayServer](./core/input/input.h#L264-L264))

4. **音频模块**
   - 音频驱动管理器 ([AudioDriverManager](./servers/audio/audio_server.h#L160-L177))
   - 音频服务器初始化 ([AudioServer](./servers/audio/audio_server.h#L181-L517))

5. **XR模块**
   - XR服务器初始化 ([XRServer](./servers/xr/xr_server.h#L53-L247)) - 用于虚拟现实和增强现实支持

6. **输入和事件系统**
   - 输入映射系统 ([InputMap](./core/input/input_map.h#L39-L116))
   - 性能监控系统 ([Performance](./main/performance.h#L41-L160))

7. **文件系统和资源管理**
   - 打包数据系统 ([PackedData](./core/io/file_access_pack.h#L60-L141))
   - ZIP文件支持 (通过 [ZipArchive](./core/io/file_access_zip.h#L38-L71))
   - 远程文件系统支持

8. **国际化和本地化**
   - 翻译服务器 ([TranslationServer](./core/string/translation_server.h#L35-L160))

9. **项目配置管理**
   - 全局设置管理器 ([ProjectSettings](./core/config/project_settings.h#L38-L244) 或 [Globals](./modules/mono/editor/GodotTools/GodotTools/Internals/Globals.cs#L7-L61))
   - 项目路径和配置加载

10. **引擎核心服务**
    - 引擎单例 ([Engine](./core/config/engine.h#L42-L228))
    - 时间管理器 ([Time](./core/os/time.h#L45-L80))
    - 对象数据库 ([ClassDB](./core/object/class_db.h#L98-L550)) - 在后续阶段初始化

11. **调试和开发工具**
    - 引擎调试器 ([EngineDebugger](./core/core_bind.h#L645-L693))
    - 单元测试框架支持

这种模块化设计使得Godot能够灵活地根据不同的运行环境(编辑器、导出模板、平台特定版本)启用或禁用某些功能模块。每个模块都遵循单例模式，通过 [get_singleton()](./servers/audio/audio_server.h#L90-L90) 方法访问其唯一实例。